<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>player</title>
</head>

<body onload="findSpotipi()">
    <p>it worky</p>
    <button onclick="play()">play this stuff buh</button>
</body>
<script>
    const spotifyToken = "{{ spotify_token }}"
    const formbarToken = "{{ formbar_token|tojson }}"
    console.log(spotifyToken)
    console.log(formbarToken)
    let digipogs = 100;
    let URI = "spotify:track:4PTG3Z6ehGkBFwjybzWkR8"
    let spotifyDeviceID = null;

    async function findSpotipi() {
        try {
            const response = await fetch('https://api.spotify.com/v1/me/player/devices', {
                method: 'GET',
                headers: {
                    "Authorization": `Bearer ${spotifyToken}`,
                    "Content-Type": "application/json"
                }

            })
            if (!response.ok) {
                throw new Error(`Error fetching devices: ${response.statusText}`);
            }

            const spotipi = data.devices.find(device => device.name === "SpotiPi");
            if (spotipi) {
                spotipiDeviceId = spotipi.id;
                console.log(`Spotipi detected! Device ID: ${spotipiDeviceId}`);
            } else {
                console.log("Spotipi not found. Make sure it is connected to Spotify.");
            }
        } catch (error) {
            console.error('Error fetching devices:', error);
            return;
        }
    }


</script>

</html>